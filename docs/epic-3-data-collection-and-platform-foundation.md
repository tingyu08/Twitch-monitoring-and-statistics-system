# Epic 3：資料收集與平台基礎設施（Data Collection & Platform Foundation）

## 1. Epic 概述

### 1.1 背景
實況主與觀眾儀表板的所有功能都依賴穩定、合法且具延展性的資料收集與儲存能力。若沒有良好的資料模型、Twitch API 串接與排程機制，前端只能顯示短期或不完整的資訊。本 Epic 聚焦於打好整個系統的「後端骨架」，支援長期統計與未來分析。

### 1.2 Epic 目標
- 建立穩定與 Twitch API 串接的授權與呼叫機制。
- 設計可支撐長期時間序列統計的資料模型。
- 實作排程 Job，週期性從 Twitch 抓取並更新必要數據。
- 建立基本安全與監控措施，確保資料可靠性與可維護性。

---

## 2. 範圍（Scope）

### 2.1 In Scope
- Twitch OAuth / API 串接與授權管理（存取 Token、更新機制）。
- 實況主、觀眾、開台紀錄與彙總統計相關資料模型設計與實作。
- 定時資料抓取與更新排程（Scheduler / Worker）。
- 基礎存取控制與安全（API 權限檢查）。
- 監控與記錄（logs）基礎能力。

### 2.2 Out of Scope（本 Epic 不做）
- 任何前端 UI／圖表呈現（由其他 Epics 處理）。
- 進階資料分析、ML 模型或推薦系統。
- 跨平台整合（先專注 Twitch）。

---

## 3. 使用者價值（User Value）

- 雖然是後台向的 Epic，但對實際使用者（實況主與觀眾）的價值體現在：
  - 儀表板數據準確、穩定、延遲可接受。
  - 不會因為 API 失敗或資料不一致而導致錯誤認知。
- 對開發與營運來說，提供：
  - 可維護的資料結構與程式架構。
  - 便於日後擴充其他平台或更多指標。

---

## 4. User Stories（Epic 內包含的 Stories）

> 下列 Stories 對應 PRD 中 Data Collection & Platform Foundation 的範圍，實際實作時可各自建立獨立 Story 文件。

### Story 3.1 – Twitch API 串接與授權管理

- **As a** 系統  
- **I want** 透過官方 Twitch API 穩定取得實況主與觀眾所需的合法數據  
- **So that** 儀表板能長期運作且符合法規與平台條款  

**重點**：
- 實作 OAuth 流程與 Token 更新 / 重新授權機制。
- 處理 Twitch Rate Limit（呼叫頻率控制）。

---

### Story 3.2 – 開台紀錄與互動統計資料模型

- **As a** 系統  
- **I want** 有合理的資料表設計儲存開台與互動統計  
- **So that** 能支援時間區間查詢與長期趨勢分析  

**重點**：
- 定義實況主（Streamer）、觀眾（Viewer）、開台紀錄（Streams / Sessions）、彙總統計（Aggregates）等資料表。
- 儘量以「彙總後的統計」為主，避免儲存所有原始聊天室訊息，降低隱私與儲存壓力。

---

### Story 3.3 – 定時資料抓取與更新排程

- **As a** 系統管理者  
- **I want** 有排程任務定時從 Twitch 抓取最新數據  
- **So that** 儀表板數據能在合理延遲內更新  

**重點**：
- 規劃不同指標的同步頻率（例如開台狀態較頻繁、統計彙總較寬鬆）。
- 實作失敗重試與錯誤記錄（log），避免無聲失敗。

---

### Story 3.4 – 安全與存取控制

- **As a** 系統管理者  
- **I want** 確保使用者資料與統計不會被未授權存取  
- **So that** 保障用戶隱私與服務信任度  

**重點**：
- 前後端 API 存取需驗證使用者身分與角色（實況主 / 觀眾）。
- 僅允許實況主讀取自己頻道的彙總統計。
- 僅允許觀眾讀取與自己身份相關的個人統計。

---

### Story 3.5 – 監控與 Log 基礎

- **As a** 運維 / 開發  
- **I want** 監控系統錯誤與關鍵指標  
- **So that** 能在異常時快速排查問題  

**重點**：
- 打通基本 request / error logging（可先用簡單方案，如檔案 / 主機 log）。
- 排程 Job 執行結果的紀錄（成功 / 失敗次數、錯誤原因）。

---

## 5. 非功能與技術要點（本 Epic 聚焦部分）

- 資料寫入與查詢需考量之後的查詢模式（按實況主 / 時間區間聚合）。  
- 需遵守 Twitch 開發者條款，不使用未授權／爬蟲方式取得資料。  
- 排程與 API 呼叫需有「節流」與「錯誤回復」策略，避免對 Twitch 造成過多壓力或被暫停。  

---

## 6. 骨幹成功指標（Epic Level）

- 排程 Job 的成功率達到設定目標（例如 ≥ 99% 成功執行）。  
- 主要儀表板查詢在正常負載下，資料可在預期時間內更新（例如延遲不超過 X 分鐘）。  
- 在測試與初期上線階段，未發生重大資料不一致或遺失事件。  

（X 等具體數字可依實際運維與產品需求再行填寫）


