## 1. 文件資訊

- **文件名稱**：Twitch 實況監控與統計平台 PRD
- **版本**：v0.1（Draft）
- **作者**：Product Manager
- **最後更新日期**：YYYY-MM-DD

---

## 2. 背景與目標

### 2.1 背景

- Twitch 提供部分後台數據與第三方統計工具，但多數工具偏向「單場表現」或短期數據。
- 實況主若想了解「長期開台習慣、訂閱趨勢、鐵粉互動行為」，往往需要：
  - 手動整理 / 截圖 / 匯出報表再自行分析，成本高且不連續。
- 重度觀眾 / 頻道管理員若想了解「自己在某台投入多少時間、互動程度」，目前缺乏一個以「觀眾視角」為主的工具。

### 2.2 問題陳述

- **實況主痛點**：缺乏針對「長期」與「全局」的開台與訂閱趨勢視角，只能看零散數據。
- **觀眾痛點**：無法一眼看出自己對某個實況主的支持程度（時間與互動層面）。
- **營運痛點**：沒有簡單工具可對比活動前後、調整時段前後的數據差異。

### 2.3 產品目標

- **目標 1**：為實況主提供一個「長期可視化」的營運儀表板，聚焦開台與訂閱趨勢。
- **目標 2**：為觀眾提供「個人觀影足跡與互動紀錄」，量化其支持程度。
- **目標 3**：為未來進階數據分析（鐵粉分層、營運建議）建立穩定的資料基礎。

### 2.4 非目標（本階段不納入）

- **不做** 廣告投放與收益最佳化演算法。
- **不做** 非官方爬蟲或違反 Twitch 服務條款的資料收集方式。
- **不做** 太深度的 AI 建議（如自動產生內容策略），僅預留可能性。

---

## 3. 目標用戶與使用情境

### 3.1 目標用戶

- **實況主（Streamer）**
  - 全職或半職實況主，關注自己頻道成長。
  - 想調整開台時段、內容類型與互動方式。
- **重度觀眾 / 頻道經理 / 社群營運**
  - 長期追特定實況主，或負責幫實況主管理社群、活動。
  - 想量化「投入程度」，或觀察整體觀眾活躍狀況。

### 3.2 典型使用情境（範例）

- **情境 A（實況主）**：每月底打開儀表板，查看這個月開台時數、場數、平均人數及訂閱變化，並對比上個月。
- **情境 B（實況主）**：嘗試改變開台時段一週後，想看該時段在觀看與訂閱表現上是否有改善。
- **情境 C（觀眾）**：重度粉絲想知道「自己到底看了這位實況主多少小時、留了多少留言」，並在周年或活動時當作榮耀徽章或參考。
- **情境 D（社群營運）**：想對比活動前後兩週的「活躍觀眾數」與「留言總量」，評估活動效果。

---

## 4. 範圍與功能（按 Epic / Story 組織）

### 4.1 Epic 1：實況主長期營運儀表板（Streamer Analytics Dashboard）

**目標**：讓實況主能一眼掌握自己頻道的長期開台與訂閱表現。

#### User Stories（3–5 個）

1. **Story 1.1 – 實況主登入與頻道綁定**

   - **As a** 實況主
   - **I want** 使用我的 Twitch 帳號登入並綁定頻道
   - **So that** 系統能自動為我的頻道收集與顯示統計數據
   - **主要需求**：
     - 支援透過 Twitch OAuth 登入。
     - 實況主第一次登入時需確認授權範圍。
     - 綁定後可在儀表板看到自己的頻道名稱與基本資訊。

2. **Story 1.2 – 時間區間開台統計總覽**

   - **As a** 實況主
   - **I want** 查看特定期間（例如最近 7 / 30 / 90 天）的開台統計總覽
   - **So that** 我能快速掌握自己近期的開台量與活躍程度
   - **主要需求**：
     - 可選擇時間區間（預設：最近 30 天）。
     - 顯示：總開台時數、總場數、平均單場長度。
     - 以卡片 / summary 區塊方式呈現。

3. **Story 1.3 – 開台時間與頻率圖表**

   - **As a** 實況主
   - **I want** 以圖表方式查看開台時間分布與頻率
   - **So that** 我能調整開台時段以優化表現
   - **主要需求**：
     - 折線 / 長條圖顯示每日（或每週）開台時數。
     - 熱度圖（Heatmap）或簡化版分佈圖顯示一週中各時段開台頻率。

4. **Story 1.4 – 訂閱數變化趨勢（簡版）**

   - **As a** 實況主
   - **I want** 查看指定期間內訂閱數的變化趨勢
   - **So that** 我能判斷近期表現與活動是否有助提升訂閱
   - **主要需求**：
     - 若 Twitch API 提供，顯示每日至少一個「訂閱總數」或類似 proxy。
     - 當 API 限制無法取得精準數字時，要在 UI 上清楚標示。

5. **Story 1.5 – 儀表板 UX / 基礎設定**
   - **As a** 實況主
   - **I want** 能在儀表板中簡單調整顯示設定
   - **So that** 我能專注在我在意的指標
   - **主要需求**：
     - 可選擇顯示 / 隱藏部分圖表或卡片。
     - 預設配置為「新手友善」，但可保存偏好設定（LocalStorage / 使用者層級）。

---

### 4.2 Epic 2：觀眾個人觀影與互動統計（Viewer Engagement Analytics）

**目標**：讓觀眾能看到自己在特定實況主頻道的觀看與互動投入。

#### User Stories（3–5 個）

1. **Story 2.1 – 觀眾登入與授權**

   - **As a** 觀眾
   - **I want** 使用 Twitch 帳號登入平台
   - **So that** 系統能根據我的身分顯示與我相關的統計數據
   - **主要需求**：
     - 使用 Twitch OAuth 登入。
     - 首次登入時顯示清楚的資料使用說明與同意條款。

2. **Story 2.2 – 在單一實況主頻道的觀看時數統計**

   - **As a** 觀眾
   - **I want** 查看自己在某位實況主頻道的觀看時數統計
   - **So that** 我能量化自己對該實況主的支持程度
   - **主要需求**：
     - 可選擇實況主（下拉選單 / 搜尋）。
     - 顯示指定期間的累積觀看時數（小時 / 分鐘）。
     - 視 UI 需求顯示近 7 / 30 / 90 天趨勢圖。

3. **Story 2.3 – 在單一實況主頻道的留言與互動統計**

   - **As a** 觀眾
   - **I want** 查看自己在某位實況主頻道的留言數 / 互動次數
   - **So that** 我能更清楚知道自己的活躍度
   - **主要需求**：
     - 顯示指定期間內的留言總數。
     - 若技術可行，可再細分成：訊息數、表情使用數（視 API 限制）。

4. **Story 2.4 – 觀眾足跡總覽**

   - **As a** 觀眾
   - **I want** 有一個簡單頁面總覽自己在該實況主頻道的長期投入
   - **So that** 我能看到自己追隨的軌跡與高峰時段
   - **主要需求**：
     - 顯示：加入頻道以來的總觀看時數、總留言數、平均每月觀看時數等摘要。
     - 以圖表或簡潔卡片呈現，適合作為「成就感」展示。

5. **Story 2.5 – 隱私與授權控制（觀眾端）**
   - **As a** 觀眾
   - **I want** 控制哪些資料被儲存與是否刪除
   - **So that** 我能確保自己的使用符合個人隱私期待
   - **主要需求**：
     - 觀眾可要求清除自己的統計資料（系統執行刪除或匿名化）。
     - 清楚說明哪些資料會被保存、保存多久。

---

### 4.3 Epic 3：資料收集與系統基礎設施（Data Collection & Platform Foundation）

**目標**：建立穩定合法的資料收集機制與平台基礎，支撐前兩個 Epic。

#### User Stories（3–5 個）

1. **Story 3.1 – Twitch API 串接與授權管理**

   - **As a** 系統
   - **I want** 透過官方 Twitch API 穩定取得實況主與觀眾所需的合法數據
   - **So that** 儀表板能長期運作且符合法規與平台條款
   - **主要需求**：
     - 實作 OAuth 流程與 Token 更新機制。
     - 根據 Twitch Rate Limit 設計呼叫頻率與排程。

2. **Story 3.2 – 開台紀錄與互動統計資料模型**

   - **As a** 系統
   - **I want** 有合理的資料表設計儲存開台與互動統計
   - **So that** 能支援時間區間查詢與長期趨勢分析
   - **主要需求**：
     - 定義實況主、觀眾、開台紀錄、彙總統計等資料表。
     - 儘量以「彙總後的統計」為主，避免儲存所有原始聊天內容。

3. **Story 3.3 – 定時資料抓取與更新排程**

   - **As a** 系統管理者
   - **I want** 有排程任務定時從 Twitch 抓取最新數據
   - **So that** 儀表板數據能在合理延遲內更新
   - **主要需求**：
     - 設計排程頻率（例如每 5 分鐘 / 15 分鐘視指標而定）。
     - 異常處理與重試機制（API 失敗時的降級策略）。

4. **Story 3.4 – 安全與存取控制**

   - **As a** 系統管理者
   - **I want** 確保使用者資料與統計不會被未授權存取
   - **So that** 保障用戶隱私與服務信任度
   - **主要需求**：
     - 前後端存取 API 需做身份驗證與授權檢查。
     - 依角色（實況主 / 觀眾）限制可查看的資料範圍。

5. **Story 3.5 – 監控與 Log 基礎**
   - **As a** 運維 / 開發
   - **I want** 監控系統錯誤與關鍵指標
   - **So that** 能在異常時快速排查問題
   - **主要需求**：
     - 基本 request log、錯誤 log。
     - 關鍵 job（排程）的成功 / 失敗監控。

---

### 4.4 Epic 4：實況主快速操作中心（Streamer Quick Actions Hub）

**目標**：提供實況主快速存取實況設定與收益分析功能。

**詳細規劃**：參見 `docs/epic-4-streamer-quick-actions.md`

**主要 Stories**：

- Story 4.1：實況設定快速管理
- Story 4.2：設定預設模板
- Story 4.3-4.5：收益統計與報表

---

### 4.5 Epic 5：即時通知與事件系統（Real-time Notifications）

**目標**：實現 Twitch EventSub/PubSub 即時事件處理。

**詳細規劃**：參見 `docs/epic-5-realtime-notifications-and-events.md`

**主要 Stories**：

- Story 5.1：EventSub Webhook 基礎設施
- Story 5.2：直播狀態即時通知
- Story 5.3：訂閱事件即時處理
- Story 5.4：Channel Points 兌換
- Story 5.5：前端即時通知系統

---

### 4.6 Epic 6：進階資料收集與自動化（Advanced Data Collection）

**目標**：建立自動化資料收集與歷史資料聚合。

**詳細規劃**：參見 `docs/epic-6-advanced-data-collection-automation.md`

**主要 Stories**：

- Story 6.1：定時資料抓取 Worker
- Story 6.2：歷史資料聚合
- Story 6.3：Token 自動管理
- Story 6.4：VOD 與剪輯同步
- Story 6.5：遊戲/分類統計
- Story 6.6：系統監控

---

### 4.7 Epic 7：社群互動管理（Community & Moderation）

**目標**：提供聊天室管理與版主功能。

**詳細規劃**：參見 `docs/epic-7-community-moderation-tools.md`

**主要 Stories**：

- Story 7.1：聊天室即時監控
- Story 7.2：版主操作介面
- Story 7.3：Ban/Timeout 記錄
- Story 7.4：觀眾忠誠度分析
- Story 7.5：自動化版主規則

---

### 4.8 Epic 8：直播控制與預測/投票（Stream Control & Predictions）

**目標**：直播設定控制與互動功能管理。

**詳細規劃**：參見 `docs/epic-8-stream-control-predictions.md`

**主要 Stories**：

- Story 8.1：直播標題/遊戲更新
- Story 8.2：預測（Predictions）管理
- Story 8.3：投票（Polls）管理
- Story 8.4：廣告播放控制
- Story 8.5：直播標記

---

## 5. 功能需求彙總（Functional Requirements）

### 5.1 實況主側

- **FR-S1**：系統必須支援實況主透過 Twitch OAuth 登入並綁定頻道。
- **FR-S2**：實況主可選擇時間區間並查看開台統計數據（總時數、場數、平均時長）。
- **FR-S3**：系統提供開台時間分布與頻率圖表。
- **FR-S4**：若 Twitch API 允許，提供訂閱數變化趨勢圖；若不允許須在 UI 清楚標示限制。
- **FR-S5**：實況主可調整儀表板顯示偏好。

### 5.2 觀眾側

- **FR-V1**：觀眾必須可透過 Twitch OAuth 登入。
- **FR-V2**：觀眾可選擇某位實況主並查看在該頻道的觀看時數統計。
- **FR-V3**：觀眾可查看在該頻道的留言 / 互動次數。
- **FR-V4**：觀眾可查看長期足跡概要（總觀看時數、總留言數等）。
- **FR-V5**：觀眾可要求刪除或停用自己的統計資料。

### 5.3 平台與資料

- **FR-P1**：系統需與 Twitch API 串接並定期抓取必要資料。
- **FR-P2**：系統需維護實況主 / 觀眾 / 開台紀錄 / 統計資料模型。
- **FR-P3**：需有排程任務負責資料更新並處理 API 限速 / 失敗重試。
- **FR-P4**：所有 API 必須實作身份驗證與授權。

---

## 6. 非功能需求（Non-Functional Requirements）

### 6.1 效能（Performance）

- **NFR-P1**：主要儀表板頁面在穩定網路下 **首次載入 TTFB ≤ 1.5 秒、完整可互動（TTI）≤ 3 秒**（典型資料量情境）。
- **NFR-P2**：時間區間切換或查詢操作的結果回應時間 **≤ 1 秒**（已緩存或適當索引）。
- **NFR-P3**：排程任務對 Twitch API 的呼叫須符合其 Rate Limit，避免封鎖。

### 6.2 可用性與穩定性（Availability & Reliability）

- **NFR-A1**：系統目標可用性 99%（side project 可放寬，但此為長期目標）。
- **NFR-A2**：排程 job 失敗時必須有重試與告警機制（至少寫入錯誤 log）。

### 6.3 資安與隱私（Security & Privacy）

- **NFR-S1**：所有登入與敏感操作必須透過 HTTPS。
- **NFR-S2**：不儲存 Twitch 密碼，只儲存必需的 Token（並安全加密或以 Secret 管理）。
- **NFR-S3**：觀眾資料至少提供刪除 / 匿名化的機制，符合基本隱私期待。

### 6.4 可訪問性（Accessibility）

- **NFR-A11Y1**：前端 UI 儘量符合 **WCAG 2.1 AA 精神**：
  - 文字 / 背景對比度達標。
  - 主要操作可使用鍵盤操作（tab / enter）。
  - 圖表需提供基本文字說明（例如「本圖顯示最近 30 天開台時數變化」）。
- **NFR-A11Y2**：顏色並非唯一資訊傳達方式（搭配 icon / label）。

### 6.5 SEO 與可被發現性（SEO & Discoverability）

（儀表板本身多為登入後頁面，SEO 重點在公共入口頁）

- **NFR-SEO1**：公共 Landing Page 需具備：
  - 清楚標題與 meta description（描述 Twitch 監控與統計工具）。
  - 結構化 heading（`<h1>`, `<h2>`）與基礎 Open Graph 標籤。
- **NFR-SEO2**：前端框架為 React + TypeScript，建議透過：
  - SSR / SSG（例如 Next.js）或其他策略，確保公開頁面對搜尋引擎友善。

### 6.6 可維護性（Maintainability）

- **NFR-M1**：前端採用 **React + TypeScript + Tailwind CSS**，採用明確的 component 結構與 typing。
- **NFR-M2**：關鍵邏輯（資料轉換、統計算法）應分離為可測試的函式 / 模組。
- **NFR-M3**：至少對核心功能建立自動化測試（單元 / 基本整合測試）。

---

## 7. 技術偏好與架構方向（高層級）

### 7.1 前端

- **框架**：React + TypeScript
- **樣式**：Tailwind CSS
- **建議結構**：
  - `pages` / `routes`：登入、實況主儀表板、觀眾儀表板、Landing Page。
  - `components`：Chart components、Layout、Filter / DatePicker、Summary Cards。
  - `hooks`：封裝 API 呼叫、資料 fetching 與快取（例如 React Query）。

### 7.2 後端（僅高層假設）

- 提供 REST / GraphQL API 給前端呼叫。
- 負責：
  - 與 Twitch API 溝通、OAuth token 管理。
  - 資料抓取排程與儲存。
  - 對前端提供彙總後統計結果。

---

## 8. 成功指標（Success Metrics）

### 8.1 使用層面

- **SM-1**：上線後 3 個月內，至少有 **N 位實況主** 完成頻道綁定。
- **SM-2**：已綁定實況主中，有 **≥ 50% 每週登入一次** 查看儀表板。
- **SM-3**：若開放觀眾登入，至少有 **M 位觀眾** 使用觀眾儀表板（可依專案規模調整 N / M）。

### 8.2 滿意度與價值感受

- **SM-4**：實況主問卷中，**≥ X%** 回答「覺得本工具有助於了解長期表現」。
- **SM-5**：觀眾問卷中，**≥ Y%** 回答「覺得能更清楚看到自己的支持度」。

（N / M / X / Y 具體數值待你依實際規模設定）

### 8.3 技術與營運

- **SM-6**：主要儀表板頁面載入時間與互動延遲達成前述效能 NFR。
- **SM-7**：排程 job 成功率 ≥ Z%（例如 99%+，非人為中斷情境）。

---

## 9. 開放議題與風險

- **RQ-1**：Twitch API 實際可取得的訂閱數與互動細節範圍，需要在 Spike / POC 後再確認，可能調整 Story 1.4、2.3 的細節。
- **RQ-2**：觀眾端資料的隱私條款與顯示粒度（是否允許實況主看到個別觀眾列表與細節）需要產品 / 法務 / 使用者期待三方平衡。
- **RQ-3**：是否支援多平台（YouTube、Kick 等）延伸？目前不在本 PRD 範圍，但架構宜預留擴充可能性。
