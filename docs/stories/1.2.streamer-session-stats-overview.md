# Story 1.2: streamer-session-stats-overview

## Status

- Draft

## Related Documents

- `docs/prd.md#4-範圍與功能按-epic--story-組織` – Story 1.2 原始需求背景（時間區間開台統計總覽）  
- `docs/epic-1-streamer-analytics-dashboard.md#story-12--指定期間開台統計總覽` – Epic 1 整體目標與 Story 1.2 重點  
- `docs/architecture/fullstack-architecture.md#4-資料模型設計data-model` – `StreamSession`、`ChannelDailyStat` 資料模型與彙總邏輯設計  
- `docs/architecture/front-end-architecture.md#3-專案結構設計project-structure` – `dashboard/streamer` 路由、`streamer-dashboard` feature 結構與 Summary Cards 實作位置

## Story

**As a** Twitch 實況主（Streamer）  
**I want** 查看特定期間的開台統計總覽（總開台時數、總場數、平均單場長度）  
**so that** 我能快速掌握自己近期的開台量與活躍程度。

## Acceptance Criteria

1. **可選擇時間區間並顯示摘要**
   - Given 實況主已成功登入並綁定頻道  
   - When 實況主在儀表板選擇一個時間區間（預設最近 30 天，可切換 7 / 90 天）  
   - Then 畫面會顯示該期間的：
     - 總開台時數  
     - 總開台場數  
     - 平均單場長度  

2. **摘要數值與單位清楚標示**
   - Given 儀表板已載入統計數據  
   - When 實況主查看 Summary Cards  
   - Then 每個卡片需：
     - 清楚標示指標名稱（例如「總開台時數」）  
     - 清楚標示單位（小時 / 場 / 分鐘）  
     - 對齊 UX 文件中 Dark Tech Dashboard 的樣式與可讀性要求  

3. **切換時間區間時回應速度**
   - Given 實況主在 Summary 區塊上切換不同的時間區間  
   - When 新查詢被觸發  
   - Then 新數據應在 1 秒內完成回應並更新畫面（以正常網路與合理資料量為前提），期間顯示 skeleton 或 loading 狀態。  

4. **無資料或資料不完整時的處理**
   - Given 在選定時間區間內沒有任何開台紀錄，或後端回傳資料不完整  
   - When 畫面載入 Summary Cards  
   - Then 系統應：
     - 顯示合理的空狀態（EmptyState）或 0 值  
     - 若資料不完整，需透過 Banner / Badge 清楚標示限制或估算狀態  

## Tasks / Subtasks

- [ ] Task 1（AC: 1, 2）後端彙總 API 實作
  - [ ] 在後端實作 `GET /api/streamer/me/summary?range=7d|30d|90d` 等端點
  - [ ] 使用資料模型 `StreamSession` / `ChannelDailyStat` 計算：
        - 總開台時數（秒→轉為小時）  
        - 總開台場數  
        - 平均單場長度（總時數 / 場數）  
  - [ ] 確保回傳 JSON 明確標示單位與欄位名稱

- [ ] Task 2（AC: 1, 3）前端 Summary Cards 與時間區間切換
  - [ ] 在 `Streamer Dashboard` 頁面建立 Summary Cards 區塊（依 `front-end-architecture.md` 的結構）
  - [ ] 實作 `DateRangePicker` 或等效 UI，支援 7 / 30 / 90 天快捷選項
  - [ ] 使用 React Query hooks（例如 `useStreamerSummaryQuery`）根據 range 呼叫後端 API
  - [ ] 切換區間時顯示 skeleton / loading 狀態，並在資料到達後平滑更新卡片

- [ ] Task 3（AC: 2）數值顯示格式與 UX 對齊
  - [ ] 為每個 Summary Card 設定清楚標題、副標與單位（h / 次 / 分鐘）
  - [ ] 採用 `StatCard` 元件，沿用 Dark Tech Dashboard 色彩與排版
  - [ ] 若有與前一期間比較的資訊，保留欄位但可在此 Story 中標示為未啟用或簡化

- [ ] Task 4（AC: 4）無資料與資料不完整處理
  - [ ] 後端在沒有資料的情況下回傳明確 0 值或空集合，而非錯誤
  - [ ] 若因資料延遲或 API 限制導致不完整，回傳 `isEstimated` / `dataCompleteness` 等旗標
  - [ ] 前端根據旗標顯示 EmptyState 或 Info / Warning Banner / Badge

## Dev Notes

- 此 Story 聚焦於「數據彙總 + Summary Cards 顯示」，圖表與更複雜的視覺化在 Story 1.3 處理。  
- 後端彙總邏輯應盡量依 `docs/architecture/fullstack-architecture.md#4-資料模型設計data-model` 中的 `StreamSession`、`ChannelDailyStat` 資料模型與 API 設計實作，避免在前端進行生硬運算。  
- **效能考量**：AC3 的「1 秒內回應」為目標值，實作時建議透過適當資料庫索引、彙總表設計與快取機制達成。若資料量極大，可考慮預先計算並儲存彙總結果。  
- 前端請對齊：
  - `docs/architecture/front-end-architecture.md#3-專案結構設計project-structure` 的路由與 features 結構（`dashboard/streamer`）  
  - `docs/front-end-spec.md` 中的 StatCard 風格與可用性原則  

### Testing

**測試層級建議：**
- **後端**：彙總邏輯以 **Unit / Integration** 測試為主，驗證不同時間區間與資料邊界情境下的計算正確性。  
- **前端**：Component / Page 測試 Summary Cards 渲染、時間區間切換與 loading 狀態。  
- **端對端**：至少 1 條 **E2E** 路徑驗證完整流程（登入 → 選擇區間 → 查看 Summary → 切換區間）。

**測試情境：**
- 驗證不同時間區間的 Summary：  
  - 7 / 30 / 90 天下，數字分別正確反映資料庫內容。  
- 驗證切換區間時的 loading 行為：  
  - 切換後立即顯示 skeleton，完成後平滑顯示新數值。  
- 驗證無資料情境：  
  - 若某期間無開台紀錄，顯示合理的空狀態或 0，且不報錯。  
- 驗證資料不完整 / 估算情境：  
  - 後端標記 `isEstimated` 時，前端有對應 Warning / Info 視覺提示。  

## Change Log

| Date       | Version | Description                             | Author |
| ---------- | ------- | --------------------------------------- | ------ |
| YYYY-MM-DD | 0.1     | 建立 Story 初稿：開台統計總覽需求定義   | PO     |

## Dev Agent Record

### Agent Model Used

_由 Dev Agent 於實作時填寫_

### Debug Log References

_由 Dev Agent 於實作時填寫_

### Completion Notes List

_由 Dev Agent 於實作完成時填寫_

### File List

_由 Dev Agent 於實作完成時填寫_

## QA Results

_由 QA Agent 於測試與審查後填寫_


