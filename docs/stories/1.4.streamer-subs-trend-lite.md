# Story 1.4: streamer-subs-trend-lite

## Status

- Draft

## Related Documents

- `docs/prd.md#4-範圍與功能按-epic--story-組織` – Story 1.4 原始需求背景（訂閱數變化趨勢簡版）與開放議題 RQ-1  
- `docs/epic-1-streamer-analytics-dashboard.md#story-14--訂閱數變化趨勢簡版` – Epic 1 整體目標與 Story 1.4 重點  
- `docs/architecture/fullstack-architecture.md#4-資料模型設計data-model` – `ChannelDailyStat` 中 `subsTotal` / `subsDelta` 欄位設計與 `isEstimated` 旗標說明  
- `docs/architecture/front-end-architecture.md#3-專案結構設計project-structure` – `streamer-dashboard/charts` 圖表封裝位置與共用圖表元件

## Story

**As a** Twitch 實況主（Streamer）  
**I want** 查看指定期間內訂閱數的變化趨勢（簡版）  
**so that** 我能判斷近期活動或內容策略是否影響訂閱表現。

## Acceptance Criteria

1. **訂閱趨勢圖基本顯示**
   - Given 實況主已登入並綁定頻道  
   - When 實況主選擇一個時間區間（如最近 30 / 90 天）並打開訂閱趨勢圖區塊  
   - Then 系統顯示一張折線或區域圖，呈現訂閱總數或淨變化的時間序列，x 軸為日期，y 軸為訂閱數或變化量。  

2. **資料來源限制與估算標示**
   - Given Twitch API 對訂閱數的可用資料有限或有延遲  
   - When 系統無法取得精準每日訂閱數，而改以 proxy 或估算值表示  
   - Then 前端必須：
     - 顯示明確 Banner 或 Badge（例如「數據為估算值，僅供趨勢參考」）  
     - 在 Tooltip 或說明文字中簡短說明估算邏輯或限制  

3. **與 Summary / 其他圖表的一致性**
   - Given 儀表板其他區域也顯示訂閱相關摘要（若有）  
   - When 實況主比較訂閱趨勢圖與其他指標  
   - Then 兩者在整體趨勢與數值上應一致或可合理對齊（在 API 限制範圍內），避免顯著矛盾。  

4. **資料缺失或不支援時的體驗**
   - Given Twitch API 完全不提供實作所需的訂閱資料  
   - When 實況主打開訂閱趨勢圖區塊  
   - Then 畫面應：
     - 顯示友善的說明（例如「目前 Twitch API 不提供足夠訂閱細節，此圖表暫不支援。」）  
     - 不顯示誤導性的亂數或空圖表  

## Tasks / Subtasks

- [ ] Task 1（AC: 1, 2, 3）後端訂閱統計 API
  - [ ] 研究 Twitch API 可取得的訂閱相關欄位（需結合 Spike / POC 結果）
  - [ ] 在後端定義並實作 `GET /api/streamer/me/subs-trend?range=...` 之類端點
  - [ ] 若可取得精準每日總數，回傳完整時間序列；否則：
        - 以可用 proxy（例如總訂閱、近期變動事件）計算估算值  
        - 在回傳 JSON 中標記 `hasExactData`, `isEstimated`, `estimateSource` 等欄位  

- [ ] Task 2（AC: 1）前端訂閱趨勢圖元件
  - [ ] 在 `streamer-dashboard` feature 下新增 `SubsTrendChart` 元件
  - [ ] 使用既有圖表封裝（同 Story 1.3）呈現訂閱時間序列
  - [ ] 在 Tooltip 中顯示日期、訂閱值與單位

- [ ] Task 3（AC: 2, 4）限制與錯誤顯示
  - [ ] 若 `hasExactData=false` 或 `isEstimated=true`，在圖表上方顯示 Info / Warning Banner
  - [ ] 若完全無法取得任何訂閱資料，顯示 EmptyState 與說明文案，而非渲染空圖
  - [ ] 文案內容需對齊 PRD 中對資料限制需「清楚標示」的要求

- [ ] Task 4（AC: 3）與其他指標一致性檢查
  - [ ] 確保若有訂閱相關 Summary Card（未來 Story），其使用相同資料來源或清楚說明差異
  - [ ] 新增單元測試 / 整合測試以驗證同一段期間不同端點之間的關聯合理

## Dev Notes

- 這個 Story 刻意標示為「簡版」：實作時應以「提供方向性趨勢」為主，而非追求 100% 精確度。  
- 請密切參考：
  - `docs/prd.md#4-範圍與功能按-epic--story-組織` 對 Story 1.4 的描述與開放議題 RQ-1  
  - `docs/architecture/fullstack-architecture.md#4-資料模型設計data-model` 中 `ChannelDailyStat` 的 `subsTotal` / `subsDelta` 欄位與 `isEstimated` 旗標設計  
- **Spike 決策條件**：若 Spike 結果顯示 Twitch API 無法支援合理的趨勢（例如：每日至少 7 天無法補足，且誤差超過 20%），可考慮：
  - 將本 Story 轉為「僅顯示高層摘要 + 說明限制」  
  - 或暫時降級為 UX 層級的資訊 Banner，而非實際圖表  
- **資料一致性**：若 Story 1.2 或其他 Story 中也有訂閱相關 Summary Card，需確保使用相同資料來源或清楚說明差異，避免數值矛盾。  

### Testing

**測試層級建議：**
- **後端**：訂閱統計 API 以 **Unit / Integration** 測試為主，驗證 `hasExactData`、`isEstimated` 旗標邏輯與資料計算正確性。  
- **前端**：Component 測試 `SubsTrendChart` 的渲染、估算狀態 Banner 顯示與 EmptyState 處理。  
- **端對端**：至少 1 條 **E2E** 路徑驗證完整流程（登入 → 選擇區間 → 查看訂閱趨勢 → 確認估算標示）。

**測試情境：**
- 驗證有完整資料情境：  
  - 測試環境中人工插入 subs 統計，確認圖表顯示正確趨勢與數值。  
- 驗證估算情境：  
  - 模擬 `isEstimated=true` 回傳，前端是否正確顯示 Warning / Info。  
- 驗證無資料情境：  
  - 當後端回傳「不支援」狀態時，圖表區顯示正確文案，而非空白或錯誤。  
- **資料一致性檢查**：同一段期間內，若有其他訂閱 Summary Card（例如 Story 1.2 的延伸），兩者趨勢需在容忍誤差內一致。  

## Change Log

| Date       | Version | Description                                 | Author |
| ---------- | ------- | ------------------------------------------- | ------ |
| YYYY-MM-DD | 0.1     | 建立 Story 初稿：訂閱數變化趨勢（簡版）需求 | PO     |

## Dev Agent Record

### Agent Model Used

_由 Dev Agent 於實作時填寫_

### Debug Log References

_由 Dev Agent 於實作時填寫_

### Completion Notes List

_由 Dev Agent 於實作完成時填寫_

### File List

_由 Dev Agent 於實作完成時填寫_

## QA Results

_由 QA Agent 於測試與審查後填寫_


